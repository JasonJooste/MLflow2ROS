# Tests

## Unit tests
Unit tests are pytests that check the functionality for converting a model's input/output format into suitable ROS msg types. These are located in `tests/unit`.

## Integration tests 

### Relevant files
`tests/integration/test_nodes/src` contains the code for the ROS nodes that run in the validation container. These nodes query the model nodes that are generated by MLflow2ROS and tests if a correct response is received. 

`tests/integration/test_nodes/Dockerfile` is the Dockerfile which builds the validation container. This container has all of the ROS nodes in `test_nodes/src` installed and ready to run.

`tests/integration/model_*.py` are the models used in the integration tests. These are run and logged to an ephemeral mlflow server during the integration tests. 

`tests/integration/test_integration.py` is the controller file which spins up all the integration tests.

### How they work
The integration tests validate whether MLflow2ROS is able to create a container capable of sending and receiving requests for a specific model.

For every model, the following is done during the integration test:
- The model is logged to a mlflow server, similar to how a developer would log models.
- MLflow2ROS is run with that model. 
- A validation ROS node is run. It sends a request to the model container generated by MLflow2ROS and the response will be checked by it.

All models are run on the local development environment and dependencies are listed in `requirements_dev.txt`.

Files generated as part of running the integration tests are placed in the `tests_generated_files` directory.

### How to create a new test
Each integration test consists of: 
- A model 
- A test node 
- Model msg package
- A test function in `test_integration.py`

A model needs to be procured, and a function that can be called by `test_integration.py` to run and log it needs to be made. Any dependencies should be added to `requirements_dev.txt`. They are named with the model_ prefix and are placed in the models directory.

A test node needs to contain a ROS package with the message files that expected to be generated, as well as a node with an executable that sends a request to the model node and checks it's response. This is can be done with a python script.

A new function with the test_ prefix needs to be added to `test_integration.py` for pytest to recognise the test and run it. The structure of the function can be copied from existing test functions. 
